# Template file for 'forgejo'

homepage="https://forgejo.org"
license="GPL-3.0-or-later"
maintainer="Markus Heiser <markus.heiser@darmarit.de>"
pkgname=forgejo
version=9.0.2
revision=1
short_desc="Self-hosted, lightweight software forge"
makedepends="git nodejs go go-bindata sqlite-devel pam-devel"
make_build_args="build"
depends="git git-lfs"
conflicts="gitea"
distfiles="https://codeberg.org/forgejo/forgejo/archive/v${version}.tar.gz"
checksum=80569351d553a9d4e3c08ada87d3dc2ed17ff49313e3ee21fc0ff0fcb1373a19
changelog="https://codeberg.org/forgejo/forgejo/src/branch/forgejo/RELEASE-NOTES.md"

build_style=gnu-makefile
export TAGS="bindata timetzdata sqlite sqlite_unlock_notify pam"

# export FORGEJO_VERSION="${version}"

system_accounts="_forgejo"
_forgejo_homedir="/var/lib/forgejo"
_forgejo_shell="/bin/sh"

make_dirs="\
	/var/lib/forgejo 0750 _forgejo _forgejo
	/var/log/forgejo 0755 _forgejo root
"

post_install() {
	vsv forgejo
	vsconf custom/conf/app.example.ini
}
